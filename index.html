<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Visualizar Ficha</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

 <style>
  @import url('https://fonts.googleapis.com/css2?family=IM+Fell+DW+Pica&family=MedievalSharp&display=swap');

  /* Scrollbar para navegadores WebKit (Chrome, Edge, Opera, etc.) */
::-webkit-scrollbar {
  width: 12px;
  height: 12px;
}

::-webkit-scrollbar-track {
  background: #3e2f1c; /* tom de couro escuro */
  border: 2px solid #8b5a2b; /* moldura bronze */
  border-radius: 6px;
}

::-webkit-scrollbar-thumb {
  background: repeating-linear-gradient(
    45deg,
    #b8860b,
    #b8860b 4px,
    #8b5a2b 4px,
    #8b5a2b 8px
  ); /* dourado com listras bronze */
  border-radius: 6px;
  border: 1px solid #3e2f1c;
}

::-webkit-scrollbar-thumb:hover {
  background: repeating-linear-gradient(
    45deg,
    #d4af37,
    #d4af37 4px,
    #a0522d 4px,
    #a0522d 8px
  );
}

/* Firefox */
* {
  scrollbar-width: thin;
  scrollbar-color: #b8860b #3e2f1c;
}


  body {
    font-family: 'IM Fell DW Pica', serif;
    margin: 0;
    padding: 10px;
    background: url('maps-middle-ages-catalan-atlas.jpg') repeat; /* textura pergaminho */
    color: #3e2f1c;
  }
.button{
  width: 100%;
    margin-top: 5px;
    padding: 10px;
    background-color: #6b4c28;
    color: #f9f5ec;
    border: none;
    border-radius: 12px;
    font-size: 1.2rem;
    font-family: 'MedievalSharp', cursive;
    cursor: pointer;
    box-shadow: 0 4px 10px rgba(107, 76, 40, 0.8);
    transition: background-color 0.4s ease;
}
  .container {
    max-width: 800px;
    margin: auto;
    margin-top: 10px;
    background: #f9f5ec  url('paper-fibers.png');
    padding: 10px;
    border: 8px double #6b4c28;
    border-radius: 20px;
    box-shadow: 5px 5px 15px rgba(80, 55, 20, 0.6);
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
  }

  h1, h2 {
    font-family: 'MedievalSharp', cursive;
    text-align: center;
    color: #4b3621;
    text-shadow: 1px 1px 0 #a67c00;
    margin-bottom: 15px;
    margin-top: 10px;
    width: 100%;
  }

  .foto-preview {
    display: block;
    margin: 10px auto 25px;
        max-width: calc(100% - 10px);
    border-radius: 15px;
    border: 5px solid #6b4c28;
    box-shadow: 0 0 12px #a67c00;
    background-color: #f0e6d2;
  }

  .field {
    margin-bottom: 12px;
    font-size: 1.1rem;
    border-bottom: 1px dotted #6b4c28;
    padding-bottom: 4px;
    width: calc(50% - 5px);
  }

  .field strong {
    color: #5a3e1b;
    font-weight: 700;
    text-shadow: 0 0 1px #a67c00;
  }

  .card-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
    margin-top: 20px;
    width: 100%;
  }

  .card-item {
    background: #e6d9b8;
    padding: 14px 16px;
    border-left: 6px solid #6b4c28;
    border-radius: 12px;
    box-shadow: inset 0 0 5px #c4ad6a;
    font-family: 'IM Fell DW Pica', serif;
    color: #4b3621;
    position: relative;
  }

  .remove-btn {
    position: absolute;
    right: 8px;
    top: 8px;
    background: #9b2c0e;
    color: #f9f5ec;
    border: none;
    border-radius: 6px;
    padding: 3px 8px;
    cursor: pointer;
    font-weight: 700;
    box-shadow: 0 0 5px #5a1604;
    transition: background-color 0.3s ease;
  }

  .remove-btn:hover {
    background-color: #bf4224;
  }

  .btn-edit {
    display: block;
    margin: auto;
    padding: 12px 28px;
    background-color: #6b4c28;
    color: #f9f5ec;
    border: none;
    border-radius: 12px;
    font-size: 1.2rem;
    font-family: 'MedievalSharp', cursive;
    cursor: pointer;
    box-shadow: 0 4px 10px rgba(107, 76, 40, 0.8);
    transition: background-color 0.4s ease;
  }

  .btn-edit:hover {
    background-color: #845f35;
  }

 .upload-container {
  position: relative;
  display: inline-block;
  width: 100%;
}

.upload-container input[type="file"] {
  display: none;
}

.btn-medieval {
  display: inline-block;
  padding: 12px 24px;
  background: linear-gradient(to bottom, #d4af37, #a67c00);
  color: #2e1a06;
  font-family: 'Cinzel', serif;
  font-size: 1rem;
  border: 3px solid #5c3a0a;
  border-radius: 12px;
  box-shadow: inset 0 0 0 2px #fff3b0, 0 4px 8px rgba(0,0,0,0.4);
  text-shadow: 0 1px 0 #fff;
  cursor: pointer;
  transition: transform 0.1s ease-in-out;
  width: 100%;
}

.btn-medieval:hover {
  background: linear-gradient(to bottom, #e1c066, #8b6500);
}


</style>

</head>
<body>
  <div class="container">
    <h1 id="nomeTitulo">Ficha do Personagem</h1>
    </div>
 <div class="container">
    <img id="fotoPreview" class="foto-preview" alt="Foto do Personagem"  src="guest.png"/>

    <div class="field" style="width: 100%;"><strong>Nome:</strong> <span id="nome"></span></div>
    <div class="field"><strong>Idade:</strong> <span id="idade"></span></div>
    <div class="field"><strong>Classe:</strong> <span id="classe"></span></div>
    <div class="field"><strong>Ra√ßa:</strong> <span id="raca"></span></div>
    <div class="field"><strong>N√≠vel:</strong> <span id="nivel"></span></div>

    <div class="field" style="width: 100%;"><strong>Tra√ßos de Personalidade:</strong> <span id="tracos"></span></div>
</div>
 <div class="container">
    <h2>Status</h2>
    <div class="field"><strong>Vida:</strong> <span id="pv"></span></div>
    <div class="field"><strong>Mana:</strong> <span id="pm"></span></div>
    <div class="field"><strong>Armadura:</strong> <span id="ca"></span></div>
    <div class="field"><strong>Esquiva:</strong> <span id="esquiva"></span></div>
    <div class="field"><strong>Bloqueio:</strong> <span id="bloqueio"></span></div>
    <div class="field"><strong>Deslocamento:</strong> <span id="deslocamento"></span></div>
</div>
 <div class="container">
    <h2>Atributos</h2>
    <div class="field"><strong>Agilidade:</strong> <span id="agilidade"></span></div>
    <div class="field"><strong>Carisma:</strong> <span id="carisma"></span></div>
    <div class="field"><strong>For√ßa:</strong> <span id="forca"></span></div>
    <div class="field"><strong>Intelig√™ncia:</strong> <span id="inteligencia"></span></div>
    <div class="field"><strong>Sabedoria:</strong> <span id="sabedoria"></span></div>
    <div class="field"><strong>Vigor:</strong> <span id="vigor"></span></div>
</div>
 <div class="container">
    <h2>Per√≠cias</h2>
    <div id="listaPericias" class="card-list"></div>
</div>
 <div class="container">
    <h2>Invent√°rio</h2>
    <div id="listaItens" class="card-list"></div>
</div>
 <div class="container">
    <h2>Habilidades</h2>
    <div id="listaHabilidades" class="card-list"></div>
</div>
 <div class="container">
    <h2>Magias</h2>
    <div id="listaMagias" class="card-list"></div>
</div>

<div class="container">
    <!-- Substitua a parte do bot√£o no final -->
   <div style="text-align: center; max-width: 400px; margin: auto;">
  <button onclick="window.location.href='editar.html'" class="btn-medieval" style="width: 100%; margin-bottom: 12px;">
    ‚úíÔ∏è Editar Ficha
  </button>

  <button onclick="exportarPDF()" class="btn-medieval" style="width: 100%; margin-bottom: 12px;">
  üìÑ Exportar como PDF
</button>
  </div>
</div>

</div>


    </div>
  </div>


<script>
  window.addEventListener("message", (event) => {
  if (!event.data || event.data.tipo !== 'ficha') return;

  const dadosRecebidos = event.data.dados;
  try {
    const ficha = JSON.parse(dadosRecebidos);
    console.log("Ficha recebida:", ficha);

    // Aqui voc√™ pode preencher os campos com os dados recebidos
    // Exemplo: document.getElementById("nome").textContent = ficha.nome;
  } catch (e) {
    console.error("Erro ao interpretar dados recebidos:", e);
  }
});
  
async function exportarPDF() {
  const { jsPDF } = window.jspdf;
  const container = document.body;

  try {
    const canvas = await html2canvas(container, {
      scale: 2,
      useCORS: true
    });

    const imgData = canvas.toDataURL("image/png");

    // Convers√£o de pixel para mil√≠metro (1px ‚âà 0.264583 mm)
    const pxToMm = px => px * 0.264583;

    const canvasWidthMm = pxToMm(canvas.width);
    const canvasHeightMm = pxToMm(canvas.height);

    const pdf = new jsPDF({
      orientation: 'portrait',
      unit: 'mm',
      format: [canvasWidthMm, canvasHeightMm]
    });

    pdf.addImage(imgData, "PNG", 0, 0, canvasWidthMm, canvasHeightMm);

    const nomeArquivo = (dados?.nome || "ficha") + "_ficha.pdf";
    pdf.save(nomeArquivo);

  } catch (err) {
    alert("Erro ao exportar o PDF.");
    console.error(err);
  }
}

  // Pega os dados do localStorage ou cria objeto vazio
  const dados = JSON.parse(localStorage.getItem("fichaRPG")) || {};

  // Garante que o valor seja um array, sen√£o retorna array vazio
  function garantirArray(valor) {
    return Array.isArray(valor) ? valor : [];
  }

  // Atualiza o texto do span pelo id
  function renderSpan(id, value) {
    document.getElementById(id).textContent = value || '-';
  }

  // Renderiza a lista de cards, com bot√£o de remover
  function renderCardList(listaId, items) {
    const container = document.getElementById(listaId);
    container.innerHTML = '';

    (items || []).forEach((item, index) => {
      const div = document.createElement('div');
      div.className = 'card-item';
      div.innerHTML = item;

     
      container.appendChild(div);
    });
  }

  // Lista dos campos simples para preencher os spans
  const campos = [
    "nome", "idade", "classe", "raca", "nivel", "tracos",
    "pv", "pm", "ca", "esquiva", "bloqueio", "deslocamento",
    "agilidade", "carisma", "forca", "inteligencia", "sabedoria", "vigor"
  ];

  // Preenche cada campo simples
  campos.forEach(c => renderSpan(c, dados[c]));

  // Se tiver foto, mostra a imagem
  if (dados.imagem) {
    document.getElementById("fotoPreview").src = dados.imagem;
  }

  // Renderiza as listas garantindo que sejam arrays
  renderCardList("listaPericias", garantirArray(dados.pericias));
  renderCardList("listaItens", garantirArray(dados.itens));
  renderCardList("listaHabilidades", garantirArray(dados.habilidades));
  renderCardList("listaMagias", garantirArray(dados.magias));

</script>

</body>
</html> 
